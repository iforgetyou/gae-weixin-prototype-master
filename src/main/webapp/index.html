<html>
<head>
    <title>猜名人</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="weixin/css/weui.min.css"/>-->
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">-->
    <!-- 可选的Bootstrap主题文件（一般不用引入） -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <!--<link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">-->
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <!--<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>-->
    <script src="bootstrap/jquery/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>-->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!--<script type="text/javascript" src="/js/groupon/guess.js?v=$!{jsversion}"></script>-->
</head>
<body>

<div class="container">
    <input type="hidden" value="123" name="username" id="username"/>
    <form class="form-horizontal">
        <fieldset>
            <div class="control-group">
                <div class="controls">
                    <input type="hidden" id="_username" value=""/>
                    <input type="hidden" id="_cardId" value=""/>
                    <img id="celebrity"
                         alt="猜猜我是谁?"
                         src=""
                         class="img-responsive  center-block"/>
                    <!-- Multiple Radios -->
                    <label class="radio" style=" text-align:center; vertical-align:middle">
                        <input type="radio" value="A" name="group" onclick="answer()">
                        <span id="answerA"></span>
                    </label>
                    <label class="radio" style=" text-align:center; vertical-align:middle">
                        <input type="radio" value="B" name="group" onclick="answer()">
                        <span id="answerB"></span>
                    </label>
                    <label class="radio" style=" text-align:center; vertical-align:middle">
                        <input type="radio" value="C" name="group" onclick="answer()">
                        <span id="answerC"></span>
                    </label>
                    <label class="radio" style=" text-align:center; vertical-align:middle">
                        <input type="radio" value="D" name="group" onclick="answer()">
                        <span id="answerD"></span>
                    </label>
                </div>
            </div>
        </fieldset>
    </form>
</div>

</body>
</html>

<script type="text/javascript">
    userName = GetQueryString("username");


    // 判断答案是否正确
    function answer() {
        answer_choowse = $("input[name='group']:checked").val();
        answer_name = $("#answer" + answer_choowse).text();
        var cardId = document.getElementById('_cardId').value;

        $.ajax({
            url: '/celebrity/check?answer_name=' + answer_name + "&username=" + username + "&cardid=" + cardId,
            type: 'POST',
            dataType: "json",
            contentType: "application/json",
            data: "",
            success: function (data) {
                if (data.status == 0) {
                    reloadcard();
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status + ":" + XMLHttpRequest.statusText + textStatus);
            }
        })
    }
    // 初始化, 加载卡片
    $(document).ready(reloadcard());

    function reloadcard() {
        username = GetQueryString("username");
        $("#_username").html(username);
        $.ajax({
            url: '/celebrity/card?username=' + username,
            type: 'POST',
            dataType: "json",
            contentType: "application/json",
            data: "",
            success: function (data) {
                if (data.status == 0) {
                    $("#celebrity").attr("src", data.image);
                    $("#answerA").html(data.answerA);
                    $("#answerB").html(data.answerB);
                    $("#answerC").html(data.answerC);
                    $("#answerD").html(data.answerD);
                    $("#_cardId").val(data.cardId);
                    $("input[type='group']").prop("checked",false);
                } else {
                    alert("全部回答正确");
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status + ":" + XMLHttpRequest.statusText + textStatus);
            }
        });
    }
    // 从url中获取参数
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null)return unescape(r[2]);
        return null;
    }
</script>
